* Configuration
This is Kahr Kunne's Emacs configuration, using literate programming with org-babel.
** Personal information
General information stuff like full name and email address.
#+NAME: Personal information
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq user-full-name "Kahr Kunne"
        user-mail-address "kahr.kunne@gmail.com")
#+END_SRC
** General configs
General/generic Emacs configuration stuff.
*** Backups
Store all backups in ~/.emacs.d/backups, instead of clutting the current directory.
#+NAME: Backups directory
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq backup-directory-alist '(("." . "~/.emacs.d/backups")))
#+END_SRC
Save often, because disk space is cheap, but data loss isn't.
#+NAME: Backups
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq delete-old-versions           -1
        version-control                t
        vc-make-backup-files           t
        auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save-list" t)))
#+END_SRC
*** History
Save minibuffer, kill-ring, search-ring and regexp-search-ring histories, because disk space is cheap
#+NAME: savehist-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq savehist-file "~/.emacs.d/savehist")
  (savehist-mode 1)
  (setq history-length t
        history-delete-duplicates t
        savehist-save-minibuffer-history 1
        savehist-additional-variables '(kill-ring search-ring regexp-search-ring))
#+END_SRC
*** Forbidden commands
Enable default-forbidden commands here.
#+NAME: forbidden
#+BEGIN_SRC emacs-lisp :tangle yes
  (put 'upcase-region 'disabled nil)
#+END_SRC
*** Other
Allow dired to delete directories
#+NAME: dired-directories
#+BEGIN_SRC emacs-lisp :tangle yes
  ;; allow dired to delete or copy dir
  (setq dired-recursive-copies (quote always)) ; “always” means no asking
  (setq dired-recursive-deletes (quote top)) ; “top” means ask once
#+END_SRC
Enable line numbers globally.
#+NAME: linum
#+BEGIN_SRC emacs-lisp :tangle yes
  (add-hook 'prog-mode-hook 'nlinum-mode)
#+END_SRC
Turn off the bell
#+NAME: bell
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq ring-bell-function 'ignore)
#+END_SRC
Turn yes/no prompts into y/n prompts
#+NAME: y-or-n-p
#+BEGIN_SRC emacs-lisp :tangle yes
  (fset 'yes-or-no-p 'y-or-n-p)
#+END_SRC
Use python 3
#+NAME: py3
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq python-python-command "/usr/bin/python3")
#+END_SRC
Always require a final newline.
#+NAME: final newline
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq require-final-newline t)
#+END_SRC
If you type while you have a selection going on, delete the selection, similar to other editors.
#+NAME: delete-section-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (delete-selection-mode t)
#+END_SRC
Auto-refresh buffers.
#+NAME: auto-revert-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (global-auto-revert-mode 1)
#+END_SRC
Auto refresh dired, silently.
#+NAME: auto-revert-dired
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq global-auto-revert-non-file-buffers t)
  (setq auto-revert-verbose nil)
#+END_SRC
Fix terminals giving extra newlines
#+NAME: terminal-fix
#+BEGIN_SRC emacs-lisp :tangle yes
  (add-hook 'term-mode-hook 'toggle-truncate-lines)
#+END_SRC
** Appearance
Change how Emacs looks.
*** Toolbars
Disable toolbars, because I don't need them
#+NAME: Toolbars
#+BEGIN_SRC emacs-lisp :tangle yes
  (if (fboundp 'menu-bar-mode) (menu-bar-mode -1))
  (if (fboundp 'tool-bar-mode) (tool-bar-mode -1))
  (if (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))
#+END_SRC
*** Custom
Stuff set by Custom.
#+NAME: Custom
#+BEGIN_SRC emacs-lisp :tangle yes
  (custom-set-variables
   ;; custom-set-variables was added by Custom.
   ;; If you edit it by hand, you could mess it up, so be careful.
   ;; Your init file should contain only one such instance.
   ;; If there is more than one, they won't work right.
   '(browse-url-browser-function (quote browse-url-generic))
   '(browse-url-generic-program "browseropen.sh")
   '(custom-safe-themes
     (quote
      ("104df8353e0475e27eac464e780400273ef384fa5803af8af8d0a27e2c33b761" "1e3b2c9e7e84bb886739604eae91a9afbdfb2e269936ec5dd4a9d3b7a943af7f" "39dd7106e6387e0c45dfce8ed44351078f6acd29a345d8b22e7b8e54ac25bac4" "cc60d17db31a53adf93ec6fad5a9cfff6e177664994a52346f81f62840fe8e23" "158ca85e9f3eacdcbfc43163200b62c900ae5f64ba64819dbe4b27655351c051" "8db4b03b9ae654d4a57804286eb3e332725c84d7cdab38463cb6b97d5762ad26" "a8245b7cc985a0610d71f9852e9f2767ad1b852c2bdea6f4aadc12cce9c4d6d0" "8aebf25556399b58091e533e455dd50a6a9cba958cc4ebb0aab175863c25b9a4" "d677ef584c6dfc0697901a44b885cc18e206f05114c8a3b7fde674fce6180879" "ea489f6710a3da0738e7dbdfc124df06a4e3ae82f191ce66c2af3e0a15e99b90" default)))
   '(org-agenda-files (quote ("~/gitgud.org")))
   '(py-force-py-shell-name-p t)
   '(py-shell-name "python2"))
  (custom-set-faces
   ;; custom-set-faces was added by Custom.
   ;; If you edit it by hand, you could mess it up, so be careful.
   ;; Your init file should contain only one such instance.
   ;; If there is more than one, they won't work right.
   '(org-level-1 ((t (:inherit variable-pitch :foreground "#FD971F" :height 1.0 :family "Terminus"))))
   '(org-level-2 ((t (:inherit variable-pitch :foreground "#A6E22E" :height 1.0 :family "Terminus"))))
   '(org-level-3 ((t (:inherit variable-pitch :foreground "#66D9EF" :height 1.0 :family "Terminus"))))
   '(org-level-4 ((t (:inherit variable-pitch :foreground "#E6DB74" :height 1.0 :family "Terminus"))))
   '(org-level-5 ((t (:inherit variable-pitch :foreground "#E6DB74" :height 1.0 :family "Terminus")))))
#+END_SRC
*** Theme and font
Set the theme and font
#+NAME: Theme
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq custom-safe-themes t)
  (set-frame-font "Terminus-12")
  (use-package random-splash-image
    :config
    (defun use-fancy-splash-screens-p () t)
    (setq random-splash-image-dir (concat (getenv "HOME") "/Pictures/emacs-splashes"))
    (random-splash-image-set))
  (use-package ample-theme)
  (ample-theme)
#+END_SRC
**** TODO Font doesn't currently work right, requires .Xdefaults hack
*** powerline
Powerline for Emacs.
https://github.com/milkypostman/powerline
#+NAME: powerline
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package powerline
    :config (powerline-default-theme))
#+END_SRC
** Packages
Configuration for packages. This category is kind of ambigious.
*** Initialize packages
Add alternative package sources such as melpa. Note that currently this is unsafe - the org repository doesn't use https, and AFAIK none of them use TLS. There is a fix for this floating online, but at the time I couldn't get it to work.
#+NAME: Package initialization
#+BEGIN_SRC emacs-lisp :tangle yes
    (setq package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                             ("org" . "http://orgmode.org/elpa/")
                             ("melpa" . "https://melpa.org/packages/")
                             ("melpa-stable" . "https://stable.melpa.org/packages/")
                             ("elpy" . "http://jorgenschaefer.github.io/packages/")))
    (package-initialize)
#+END_SRC

Initialize use-package
#+NAME: Use-package
#+BEGIN_SRC emacs-lisp :tangle yes
  (require 'package)
;;  (setq package-enable-at-startup nil)
;;  (package-initialize)
#+END_SRC
*** Programming
**** geiser
Geiser is like SLIME for Scheme. 
http://www.nongnu.org/geiser/
#+NAME: Geiser
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package geiser
    :config
    (add-hook 'scheme-mode-hook 'geiser-mode))  
#+END_SRC
**** SLIME
Use the Superior Lisp Interaction Mode for Emacs (SLIME).
https://common-lisp.net/project/slime/
(currently turned off due to some bug)
TODO: Fix
#+NAME: SLIME
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package slime
    :config
    (setq inferior-lisp-program "/usr/bin/sbcl")
    (load (expand-file-name "~/quicklisp/slime-helper.el")))
#+END_SRC
Use slime-company, for autocompletions using company-mode.
https://github.com/anwyn/slime-company
#+NAME: slime-company
ffda#+BEGIN_SRC emacs-lisp :tangle no
  (use-package slime-company
    :config
    (slime-setup '(slime-company)))
#+END_SRC
***** TODO Learn properly
***** TODO Use more often (by programming in lisp more often ;-))
***** TODO Figure out if  I still need the slime-helper.el file
***** TODO Get working again (currently broken)
**** agressive-indent
Keep code *always* indented
https://github.com/Malabarba/aggressive-indent-mode
Currently off.
#+NAME: agressive-indent
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package agressive-indent
    :config
    (aggressive-indent-global-mode 1))
#+END_SRC
**** company
Text completion framework for Emacs. Allows for text completion.
http://company-mode.github.io/
#+NAME: company
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package company
    :config
    (add-hook 'after-init-hook 'global-company-mode)
    (setq company-idle-delay 0.25)
    (setq company-tooltip-limit 10)
    (setq company-minimum-prefix-length 4)
    (defun my/python-mode-hook ()
      (add-to-list 'company-backends 'company-jedi))
    (add-hook 'python-mode-hook 'my/python-mode-hook))
#+END_SRC
**** flycheck
Very good syntax checking.
http://www.flycheck.org/en/latest/
Note to self: developer (lunaryorn) is a massive jackass
#+NAME: flycheck
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package flycheck
    :config
    (add-hook 'after-init-hook #'global-flycheck-mode))
#+END_SRC
**** lispy + lispyville
Lispy: reimagination of paredit, with a vi-esque slant.
https://github.com/abo-abo/lispy
#+NAME: lispy
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package lispy
    :config
    (add-hook 'emacs-lisp-mode-hook (lambda () (lispy-mode) 1))
    (add-hook 'eval-expression-minibuffer-setup-hook (lambda () (lispy-mode 1)))
    (add-hook 'ielm-mode-hook (lambda () (lispy-mode 1)))
    (add-hook 'lisp-mode-hook (lambda () (lispy-mode 1)))
    (add-hook 'lisp-interaction-mode-hook (lambda () (lispy-mode 1)))
    (add-hook 'scheme-mode-hook (lambda () (lispy-mode 1))))
#+END_SRC

Lispyville: Lisp editing for evil, using together with lispy
https://github.com/noctuid/lispyville
#+NAME: lispyville
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package lispyville
    :config
    (add-hook 'lispy-mode-hook #'lispyville-mode))
#+END_SRC
**** jedi
Autocompletion for python
#+NAME: jedi
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package jedi
    :init
    (add-hook 'python-mode-hook 'jedi:setup)
    (add-hook 'python-mode-hook 'jedi:ac-setup)
    (add-hook 'python-mode-hook (lambda () (company-mode -1)))
    (add-hook 'python-mode-hook 'ac-linum-workaround))
#+END_SRC
**** web-mode
Major-mode for all the web-related stuff.
http://web-mode.org/
#+NAME: web-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package web-mode
    :init
    (add-to-list 'auto-mode-alist '("\\.phtml\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.tpl\\.php\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.[agj]sp\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.as[cp]x\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.erb\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.mustache\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.djhtml\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.tmpl\\'" . web-mode))
    (setq web-mode-engines-alist
          '(("cheetah" . "\\.tmpl\\'"))))
#+END_SRC
*** Visual
**** rainbow-delimiters
Rainbow delimiters, give parens rainbow colors. Mostly useful when programming lisp.
https://github.com/Fanael/rainbow-delimiters
#+NAME: rainbow-delimiters
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package rainbow-delimiters
    :config
    (add-hook 'prog-mode-hook #'rainbow-delimiters-mode))
#+END_SRC
**** dired-details+
Allows you to hide some dired details, such as read/write permissions, creation date etc. Toggle with '(' or ')'.
https://www.emacswiki.org/emacs/dired-details+.el
#+NAME: dired-details+
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package dired-details+
    :commands dired-details-toggle
    :config
    (setq-default dired-details-hidden-string "--- ")
    (dired-details-install)
    (dired-details-hide)
    (add-hook 'dired-mode-hook 'dired-details-toggle))
#+END_SRC
**** fic-mode
Highlights TODO, FIXME etc
https://github.com/lewang/fic-mode
#+NAME: fic-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package fic-mode
    :config
    (add-hook 'prog-mode-hook #'fic-mode))
#+END_SRC
**** rainbow-mode
Display hex colours in their corresponding colour.
https://julien.danjou.info/projects/emacs-packages
#+NAME: rainbow-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package rainbow-mode
    :config
    (rainbow-mode 1))
#+END_SRC
*** Navigation
**** avy
Allows you to jump to any character in an easy and intuitive way. Analogous to vim-easymotion.
Configurations are such that avy behaves a bit more like ace-jump would.
https://github.com/abo-abo/avy
#+NAME: avy
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package avy
    :commands (avy-goto-line)
    :bind (("C-c l" . avy-goto-line))
    :config
    (setq avy-keys (number-sequence ?a ?z))
    (setq avy-all-windows nil))
#+END_SRC
***** TODO Start using more often
**** ace-window
Switch between windows using ace-jump.
https://github.com/abo-abo/ace-window
#+NAME: ace-window
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package ace-window
    :commands (ace-window)
    :bind (("C-x o" . ace-window))
    :config
    (setq aw-keys '(?a ?s ?d ?f ?j ?k ?l ?; ?g ?h))) 
#+END_SRC
**** windmove
Move to a different window more easily.
https://www.emacswiki.org/emacs/WindMove

#+NAME: windmove
#+BEGIN_SRC emacs-lisp :tangle yes
  (global-set-key (kbd "s-<left>") 'windmove-left)
  (global-set-key (kbd "s-<right>") 'windmove-right)
  (global-set-key (kbd "s-<down>") 'windmove-down)
  (global-set-key (kbd "s-<up>") 'windmove-up)
#+END_SRC
*** Project management
**** magit
Magit is an extremely powerful and pleasant Git interface for Emacs. If you use Git a lot, this package is pretty much a must.
https://magit.vc/
#+NAME: magit
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package magit
    :config
    (setq with-editor-emacsclient-executable "/usr/bin/emacsclient-emacs-25"))
#+END_SRC
***** TODO Unlock the full potential of git and magit
*** Text editing
**** evil
Vi(m) emulation layer for Emacs. The best of the best - I wouldn't use Emacs if this didn't exist (and I love Emacs!)
https://bitbucket.org/lyro/evil/wiki/Home
#+NAME: evil
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package evil
    :commands evil-ex
    :config
    (evil-mode 1))

  (require 'evil)
  (define-key evil-normal-state-map (kbd ";") 'evil-ex)
  (define-key evil-normal-state-map (kbd "SPC") 'avy-goto-char)
  (define-key evil-visual-state-map (kbd "SPC") 'avy-goto-char)
#+END_SRC
Also get evil-surround, for surrounding text (for example, in parens). Port of vim-surround.
#+NAME: evil-surround
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package evil-surround
    :config
    (evil-surround-mode t))
#+END_SRC
***** TODO Brush up my vim-fu - it's gotten kinda rusty
***** TODO There's a reason for the latter half of this code, but I forgot what
***** TODO Start using evil-surround again
**** multiple-cursors
Multiple cursors, useful as a replacement for macros in some cases.
IMO, sometimes feels a bit hacky because it very much operates on text and not structure. Doesn't play too well with evil-mode.
https://github.com/magnars/multiple-cursors.el
#+NAME: multiple-cursors
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package multiple-cursors
    :config
    ;; Multiple-cursors doesn't play well with evil mode.
    ;; Disable evil mode when going into multiple-cursors-mode.
    (add-hook 'multiple-cursors-mode-enabled-hook 'evil-emacs-state)
    (add-hook 'multiple-cursors-mode-disabled-hook 'evil-normal-state)
    (setq mc/unsupported-minor-modes '(company-mode auto-complete-mode flyspell-mode jedi-mode)))
#+END_SRC
***** TODO Keybindings
***** TODO Learn to use and start using
**** expand-region
Allows for easier selection, by incrementally expanding the selected area.
https://github.com/magnars/expand-region.el
#+NAME: expand-region
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package expand-region
    :commands er/expand-region
    :bind ("C-=" . er/expand-region))
#+END_SRC
**** yasnippet
Gives snippets, similar to what TextMate did.
https://github.com/joaotavora/yasnippet
#+NAME: yasnippet
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package yasnippet
    :bind
    ("C-c c" . yas-expand)
    :config
    (yas-global-mode 1))
#+END_SRC
*** Emacs enhancements
**** ivy
Like helm, but cleaner and faster.
https://github.com/abo-abo/swiper

#+NAME: ivy
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package ivy
    :bind
    (:map ivy-mode-map
          ("C-'" . ivy-avy))
    :config
    (ivy-mode 1)
    (setq ivy-height                10
          ivy-count-format          "(%d/%d) "
          ivy-use-virtual-buffers   t)
    (global-set-key (kbd "C-s") 'swiper)
    (global-set-key (kbd "M-x") 'counsel-M-x)
    (global-set-key (kbd "C-x C-f") 'counsel-find-file)
    (global-set-key (kbd "<f1> f") 'counsel-describe-function)
    (global-set-key (kbd "<f1> v") 'counsel-describe-variable)
    (global-set-key (kbd "<f1> l") 'counsel-find-library)
    (global-set-key (kbd "<f2> i") 'counsel-info-lookup-symbol)
    (global-set-key (kbd "<f2> u") 'counsel-unicode-char)
    (global-set-key (kbd "C-c j") 'counsel-git-grep)
    (global-set-key (kbd "C-c k") 'counsel-ag)
    (global-set-key (kbd "C-x l") 'counsel-locate)
    (global-set-key (kbd "C-c C-r") 'ivy-resume))
#+END_SRC
**** helm
Completion and selection framework. Fork of anything.el. Hard to explain exactly what it does, but one of the best Emacs packages out there IMO.
https://github.com/emacs-helm/helm
Currently off, as I'm using Ivy now.

#+NAME: helm
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package helm
    :init (require 'helm-config)
    :commands (helm-command-prefix
               helm-execute-persistent-action
               helm-select-action
               helm-select-action
               helm-M-x
               helm-show-kill-ring
               helm-mini
               helm-find-files
               helm-google-suggest)
    :bind (("C-c h" . helm-command-prefix)
           ("M-x" . helm-M-x)
           ("M-y" . helm-show-kill-ring)
           ("C-x b" . helm-mini)
           ("C-x C-f" . helm-find-files)
           ("C-c h q" . helm-google-suggest)
           :map helm-map
           ("<tab>" . helm-execute-persistent-action)
           ("C-i" . helm-execute-persistent-action)
           ("C-z" . helm-select-action))
    :config
    (helm-mode t)
    (helm-autoresize-mode 1)
    (global-unset-key (kbd "C-x c"))
    (setq helm-split-window-in-side-p            t
          helm-move-to-line-cycle-in-source      t
          helm-ff-search-library-in-sexp         t
          helm-scroll-amount                     8
          helm-ff-file-name-history-use-recentf  t
          helm-mode-fuzzy-match                  t
          helm-completion-in-region-fuzzy-match  t
          helm-autoresize-max-height             30)
    (helm-autoresize-mode t)
    (when (executable-find "curl")
      (setq helm-google-suggest-use-curl-p t))
    (add-to-list 'helm-sources-using-default-as-input 'helm-source-man-pages))
#+END_SRC
**** key-chord
Allows key chording, meaning that pressing multiple keys simultaneously or soon after another will run a command.
https://www.emacswiki.org/emacs/download/key-chord.el
#+NAME: key-chord
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package key-chord
    :config
    (setq key-chord-two-keys-delay 0.5)
    (key-chord-mode t))
;; It wants to have this outside of :config for some reason.
;; TODO: Check out if it still does.
  (key-chord-define evil-insert-state-map "jj" 'evil-normal-state)
#+END_SRC
***** TODO See code
**** which-key
Shows keybindings for currently entered incomplete command. Useful for discovery or if you forgot what the keybinding for something was.
https://github.com/justbur/emacs-which-key
#+NAME: which-key
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package which-key
    :config
    (which-key-mode t))
#+END_SRC
**** dired+
An improvement on dired.
https://www.emacswiki.org/emacs/DiredPlus
#+NAME: dired+
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package dired+)
#+END_SRC
**** sr-speedbar
File sidebar for Emacs.
https://www.emacswiki.org/emacs/SrSpeedbar
#+NAME: sr-speedbar
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package sr-speedbar
    :bind
    (("C-c s" . sr-speedbar-toggle)))
#+END_SRC
** EXWM
Code for the X Emacs Window Manager (EXWM).
https://github.com/ch11ng/exwm/wiki
(Currently turned off)
#+NAME: exwm
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package exwm)
  (use-package exwm-x)
  (use-package exwm-config
    :config
    ;; 9 Workspaces by default
    (setq exwm-workspace-number 10)
    ;; Naming windows; see the EXWM example config (https://github.com/ch11ng/exwm/wiki/Configuration-Example)
    (add-hook 'exwm-update-class-hook
              (lambda ()
                (unless (or (string-prefix-p "sun-awt-X11-" exwm-instance-name)
                            (string= "gimp" exwm-instance-name))
                  (exwm-workspace-rename-buffer exwm-class-name))))
    (add-hook 'exwm-update-title-hook
              (lambda ()
                (when (or (not exwm-instance-name)
                          (string-prefix-p "sun-awt-X11-" exwm-instance-name)
                          (string= "gimp" exwm-instance-name))
                  (exwm-workspace-rename-buffer exwm-title))))
    ;; Keybindings
    ;; Functions
    (defun exwm-kahr/launcher ()
      (interactive)
      (exwm-x-run-shell-command "bash -c 'rofi -show run'"))
    (defun exwm-kahr/terminal ()
      (interactive)
      (exwm-x-run-shell-command "urxvt"))
    (exwm-input-set-key (kbd "s-x") #'exwm-reset)
    (exwm-input-set-key (kbd "s-w") #'exwm-workspace-switch)
    (dotimes (i 10)
      (exwm-input-set-key (kbd (format "s-%d" i))
                          `(lambda ()
                             (interactive)
                             (exwm-workspace-switch ,i)))) 
    (exwm-input-set-key (kbd "s-r") 'exwm-kahr/launcher)
    (exwm-input-set-key (kbd "s-t") 'exwm-kahr/terminal)
    ;; Start EXW
    (require 'exwm-randr)
    (setq exwm-randr-workspace-output-plist '(0 "DVI-I-1" 1 "VGA-0"))
    (add-hook 'exwm-randr-screen-change-hook
              (lambda ()
                (start-process-shell-command
                 "xrandr" nil "xrandr --output DVI-I-1 --right-of VGA-0 --auto")))
    (exwm-enable)
    (exwm-randr-enable))
#+END_SRC
** Org
*** Agenda
Org's agenda is essentially a replacement for a real-life agenda.

Agenda files
#+NAME: org-agenda-files
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq org-agenda-files (quote ("~/Life/agenda.org")))
  (add-to-list 'org-modules "org-habit")
  (setq org-todo-keywords
        '((sequence "TODO(t)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELED(c@)")))
  (global-set-key (kbd "C-c g") 'org-agenda ) 
#+END_SRC
** Custom code
*** Custom functions
Insert the current date
#+NAME: insert-date
#+BEGIN_SRC emacs-lisp :tangle yes
  (defun insert-date ()
    (interactive)
    (insert (format-time-string "%d.%m-%Y")))
#+END_SRC

Open a new line above or below the point
#+NAME: open-line-below
#+BEGIN_SRC emacs-lisp :tangle yes
  (defun open-line-below ()
    (interactive)
    (end-of-line)
    (newline)
    (forward-line -1))
  (defun open-line-above ()
    (interactive)
    (beginning-of-line)
    (newline)
    (indent-for-tab-command))
#+END_SRC

Some magit tweaks; make magit-status go full screen and restore the previous configuration upon closing.
#+NAME: magit tweaks
#+BEGIN_SRC emacs-lisp :tangle yes
  (defadvice magit-status (around magit-fullscreen activate)
    (window-configuration-to-register :magit-fullscreen)
    ad-do-it
    (delete-other-windows))
  (defun magit-quit-session ()
    "Restore the previous window configuration and kill the magit buffer."
    (interactive)
    (kill-buffer)
    (jump-to-register :magit-fullscreen))
#+END_SRC

Evaluate and replace an elisp sexp
#+NAME: eval-and-replace
#+BEGIN_SRC emacs-lisp :tangle yes
  (defun eval-and-replace ()
    "Replace the preceding sexp with its value."
    (interactive)
    (insert " ") ;; Dirty hack
    (forward-char)
    (backward-kill-sexp)
    (condition-case nil
        (prin1 (eval (read (current-kill 0)))
               (current-buffer))
      (error (message "Invalid expression")
             (insert (current-kill 0)))))
#+END_SRC

Paste above or below the point.
#+NAME: paste-above and -below
#+BEGIN_SRC emacs-lisp :tangle yes
  (defun paste-above ()
    (interactive)
    (let ((pos (point))
          (cur-max (point-max)))
      (beginning-of-line)
      (yank)
      (newline-and-indent)
      (goto-char (+ pos (- (point-max) cur-max)))))

  (defun paste-below ()
    (interactive)
    (let ((pos (point))
          (cur-max (point-max)))
      (beginning-of-line)
      (forward-line)
      (yank)
      (newline-and-indent)
      (goto-char pos)))
#+END_SRC
*** Keybindings
Pretty much self-explanatory
#+NAME: keybindings
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-c d") 'insert-date)
  (global-set-key (kbd "C-x g") 'webjump)
  (global-set-key (kbd "C-c e") 'eval-and-replace)
  (global-set-key (kbd "C-c b") 'paste-below)
  (global-set-key (kbd "C-c a") 'paste-above)
  (global-set-key (kbd "C-c m") 'magit-status)
  (global-set-key (kbd "C-c f") 'eval-region)
  (define-key evil-normal-state-map (kbd "g k") 'open-line-above)
  (define-key evil-normal-state-map (kbd "g j") 'open-line-below)
  (define-key magit-status-mode-map (kbd "q") 'magit-quit-session)
  (define-key evil-normal-state-map (kbd "g a") 'paste-above)
  (define-key evil-normal-state-map (kbd "g p") 'paste-below)
#+END_SRC
